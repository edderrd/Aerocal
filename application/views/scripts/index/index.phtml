<?php $this->JQuery()->addJavascriptFile($this->baseUrl("/js/plugins/wdCalendar_lang_US.js")) ?>
<?php $this->JQuery()->addJavascriptFile($this->baseUrl("/js/plugins/jquery.calendar.js")) ?>
<?php $this->headLink()->appendStylesheet($this->baseUrl("/css/calendar.css")) ?>
<script type="text/javascript">
    function showCalendar()
    {
        var op = {
            view: "week",
            theme:3,
            showday: new Date(),
            //EditCmdhandler:Edit,
            //DeleteCmdhandler:Delete,
            //ViewCmdhandler:,
            //onWeekOrMonthToDay:wtd,
            //onBeforeRequestData: cal_beforerequest,
            //onAfterRequestData: cal_afterrequest,
            //onRequestDataError: cal_onerror,
            //quickAddUrl: "/index/reserve/format/json",
            url:"/index/index/format/json",
            autoload: true,
            quickAddCallback: quick_add,
            //quickUpdateUrl: DATA_FEED_URL + "?method=update",
            //quickDeleteUrl: DATA_FEED_URL + "?method=remove"
            height: document.documentElement.clientHeight  - 50,
            eventItems: <?= json_encode($this->events) ?>
        };
        var p = $("#calendarcontainer").bcalendar(op).BcalGetOp();
    }

    function quick_add(start, end, isAllDay, pos, render)
    {
        $.ajax(
        {
            url: "/index/reserve/format/html",
            type: "post",
            dataType: "html",
            data: 
            {
                "startDate": start.toString(),
                "endDate": end.toString(),
                "isallday": isAllDay
            },
            success: function(data)
            {
                
                $("<div id='modal-dialog'>")
                    .dialog(
                    {
                        title: "Add Reservation",
                        show: "drop",
                        hide: "drop",
                        autoOpen: true,
                        modal: true,
                        closeOnEscape: true,
                        close: function()
                        {
                            render();
                            $("#modal-dialog").remove();
                        }
                    })
                    .html(data);
            }
        });
    }
</script>

<div id="calendarcontainer" style="overflow-y: visible; border: 1px solid #ccc"></div>
<?php $this->JQuery()->addOnLoad("showCalendar();") ?>